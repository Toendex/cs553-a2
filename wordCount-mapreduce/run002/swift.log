2014-10-23 00:58:53,681+0000 INFO  Loader JAVA Oracle Corporation Java HotSpot(TM) 64-Bit Server VM 1.7.0_51
2014-10-23 00:58:53,685+0000 INFO  Loader VERSION Swift trunk git-rev: 2d334140f2c288e5aeb3d354de0ecda35b4b3aac heads/master 6130 (modified locally)
2014-10-23 00:58:53,685+0000 INFO  Loader RUN_ID run002
2014-10-23 00:58:53,685+0000 INFO  Loader ARGUMENTS [-runid, run002, -logfile, /home/ubuntu/swift-cloud-tutorial/cs553-a2/wordCount-mapreduce/run002/swift.log, wordCount.swift]
2014-10-23 00:58:53,686+0000 INFO  Loader MAX_HEAP 954728448
2014-10-23 00:58:53,687+0000 INFO  Loader GLOBUS_HOSTNAME ip-172-31-3-79
2014-10-23 00:58:53,687+0000 INFO  Loader CWD /home/ubuntu/swift-cloud-tutorial/cs553-a2/wordCount-mapreduce/.
2014-10-23 00:58:53,689+0000 DEBUG Loader SWIFT_CONFIGURATION 
[D] /usr/local/bin/swift-trunk/etc/swift.conf
[R] swift.conf
[C] <Command Line>
{
    TCPPortRange: "50000, 50100"                            # [D] line 27
    alwaysTransferWrapperLog: true                          # [R] line 44
    executionRetries: 0                                     # [R] line 41
    fileOperationsThrottle: 8                               # [D] line 121
    fileTransfersThrottle: 4                                # [D] line 107
    hostJobSubmitThrottle: 2                                # [D] line 95
    jobSubmitThrottle: 4                                    # [D] line 83
    keepSiteDir: true                                       # [R] line 42
    lazyErrors: false                                       # [R] line 40
    logProvenance: false                                    # [D] line 200
    maxForeachThreads: 16384                                # [D] line 194
    providerStagingPinSwiftFiles: false                     # [R] line 43
    replicationEnabled: false                               # [D] line 146
    replicationLimit: 3                                     # [D] line 157
    replicationMinQueueTime: 60                             # [D] line 153
	site {
		cloud-static {
            app.python.executable: "/usr/bin/python"        # [R] line 31
			execution {
                URL: "http://127.0.0.1:50010"               # [R] line 23
                jobManager: "local:local"                   # [R] line 24
				options {
                    maxJobs: 10                             # [R] line 26
                    tasksPerNode: 4                         # [R] line 27
				}
                type: "coaster-persistent"                  # [R] line 22
			}
            filesystem.type: "local"                        # [R] line 35
            initialParallelTasks: 20                        # [R] line 33
            maxParallelTasks: 20                            # [R] line 34
            staging: "local"                                # [R] line 37
            workDirectory: "/tmp/swiftwork"                 # [R] line 36
		}
		local {
            app.f_script.executable: "/home/ubuntu/swift-cloud-tutorial/cs553-a2/wordCount-mapreduce/final.sh"# [C]
			execution {
                URL: "localhost"                            # [R] line 10
                type: "local"                               # [R] line 9
			}
			filesystem {
                URL: "localhost"                            # [R] line 6
                type: "local"                               # [R] line 5
			}
            initialParallelTasks: 31                        # [R] line 17
            maxParallelTasks: 32                            # [R] line 16
            workDirectory: "/tmp/ubuntu/swiftwork"          # [C]
		}
	}
    sites: [local, cloud-static]                            # [R] line 1
    tracingEnabled: false                                   # [D] line 51
}

2014-10-23 00:58:53,692+0000 DEBUG textfiles BEGIN SWIFTSCRIPT:
type file;

file wc_script <"wordCount.py">;
file m_script <"merge.py">;
file f_py <"final.py">;

app (file outfile[]) wordCount (file infile, int index, int reduceNum, file wc_script)
{
    python @wc_script index reduceNum @infile;
}

app (file outfile) merge (file[] infiles, file m_script)
{
    python @m_script @filenames(infiles) stdout=@outfile;
}

app (file outfile) final (file[] infiles, file f_py)
{
    f_script @filenames(infiles) stdout=@outfile;
}

int reduceNum = toInt(arg("reduceNum",   "16"));

file infile[] <filesys_mapper;pattern="split-*", location="input">;

tracef("test\n");

file reduceinfiles[][];

foreach f,i in infile {
//    tracef("%s\n",@f);
    string loc="output/"+@toString(i)+"/";
    tracef("infile location=%s\n",lo);
    file interfiles[] <filesys_mapper; pattern="*", location=loc>;
    interfiles=wordCount(f,i,reduceNum,wc_script);
    foreach ff in interfiles {
        reduceinfiles[@toInt(@ff)][i]=ff;
    }
}

file finalinputs[];

foreach i in [0:reduceNum] {
    string ofn="output/result-"+@toString(i);
    tracef("reduceNum ofn=%s\n",ofn);
    file mfile <single_file_mapper;file=ofn>;
    mfile=merge(reduceinfiles[i],m_script);
    finalinputs[i]=mfile;
}

file ffile <"output/finalresult.txt">;

ffile=merge(finalinputs, f_py);


2014-10-23 00:58:53,692+0000 DEBUG textfiles END SWIFTSCRIPT:
2014-10-23 00:58:53,692+0000 INFO  Loader wordCount.swift: source file is new. Recompiling.
2014-10-23 00:58:54,631+0000 INFO  Warnings Warning: The @ syntax for function invocation is deprecated
2014-10-23 00:58:54,705+0000 DEBUG Loader Detailed exception:
org.griphyn.vdl.karajan.CompilationException: Compile error in foreach statement at line 30
	at org.griphyn.vdl.engine.Karajan.foreachStat(Karajan.java:1188)
	at org.griphyn.vdl.engine.Karajan.statement(Karajan.java:810)
	at org.griphyn.vdl.engine.Karajan.statements(Karajan.java:770)
	at org.griphyn.vdl.engine.Karajan.program(Karajan.java:419)
	at org.griphyn.vdl.engine.Karajan.compile(Karajan.java:169)
	at org.griphyn.vdl.karajan.Loader.compile(Loader.java:491)
	at org.griphyn.vdl.karajan.Loader.main(Loader.java:191)
Caused by: org.griphyn.vdl.karajan.CompilationException: Compile error in procedure invocation at line 33
	at org.griphyn.vdl.engine.Karajan.call(Karajan.java:1070)
	at org.griphyn.vdl.engine.Karajan.statement(Karajan.java:807)
	at org.griphyn.vdl.engine.Karajan.statements(Karajan.java:770)
	at org.griphyn.vdl.engine.Karajan.foreachStat(Karajan.java:1180)
	... 6 more
Caused by: org.griphyn.vdl.karajan.CompilationException: Variable lo was not declared in this scope.
	at org.griphyn.vdl.engine.Karajan.expressionToKarajan(Karajan.java:1576)
	at org.griphyn.vdl.engine.Karajan.actualParameter(Karajan.java:1287)
	at org.griphyn.vdl.engine.Karajan.actualParameter(Karajan.java:1273)
	at org.griphyn.vdl.engine.Karajan.call(Karajan.java:904)
	... 9 more
